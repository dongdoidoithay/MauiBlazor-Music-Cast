@inherits LayoutComponentBase
@inject NavigationManager NavigationManager

<MudThemeProvider/>
<MudDialogProvider/>
<MudSnackbarProvider/>


<ErrorBoundary @ref="@_errorBoundary">
    <ChildContent>
        <div class="page">
            <MudHidden Breakpoint="Breakpoint.SmAndDown">
                <div class="page-header d-flex" >
                    <div class="logo d-flex align-center">
                        <div class="title ml-2">MUSIC</div>
                    </div>
                    <div class="d-flex align-center" @onmouseup:stopPropagation="true" @onmousedown:stopPropagation="true">
                       
                    </div>
                    <div class="flex-grow-1 ml-2 d-flex align-center">
                        @if (!NavigationManager.Uri.EndsWith("/search"))
                        {
                            <div style="width:250px" @onmouseup:stopPropagation="true" @onmousedown:stopPropagation="true">
                               
                            </div>
                        }
                    </div>
                    <div @onmouseup:stopPropagation="true" @onmousedown:stopPropagation="true">
                       
                    </div>
                </div>
            </MudHidden>

            <div class="page-nav">
               
            </div>
            <div class="page-main">
                <div class="containerPage">
                    @Body
                </div>
            </div>
            <div class="page-bottom">
               
            </div>
        </div>
    </ChildContent>
    <ErrorContent Context="ex">
        <div class="pa-5" style="user-select: text;">
            <div class="d-flex justify-space-between align-center">
                <MudAlert Class="mr-2"
                          Variant="Variant.Filled"
                          Dense="true"
                          Severity="Severity.Error">Chương trình gặp phải lỗi không xác định!</MudAlert>

                <MudButton Variant="Variant.Outlined"
                           Size="Size.Small"
                           IconColor="Color.Primary"
                           OnClick="@(()=>ResetError(ex))">Reset</MudButton>
            </div>
            <div class="error-message mt-3">
                @($"{ex.Message}{Environment.NewLine}{ex.StackTrace}")
            </div>
        </div>
    </ErrorContent>
</ErrorBoundary>

@code {
    private bool _isDarkMode;
    private ErrorBoundary? _errorBoundary;
    // private MudThemeProvider _mudThemeProvider;
    // private MudTheme _customTheme;

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
       // _customTheme = CustomTheme.Theme;
    }


    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            // switch (Settings.Environment.General.AppThemeInt)
            // {
            //     case 0:
            //         _isDarkMode = await _mudThemeProvider.GetSystemPreference();
            //         break;
            //     case 1:
            //         _isDarkMode = false;
            //         break;
            //     case 2:
            //         _isDarkMode = true;
            //         break;
            //     default:
            //         break;
            // }
            // await InvokeAsync(StateHasChanged);
            // await NativeTheme.SetThemeAsync(_isDarkMode);
            // if (Settings.Environment.General.IsAutoCheckUpdate)
            // {
            //     await AutoUpgrade.DoAsync(true);
            // }
        }
    }

    private void ResetError(Exception ex)
    {
      
        _errorBoundary?.Recover();
    }

  
}